<!DOCTYPE html>
<html>
<head>
<meta name="viewport" charset="UTF-8">
<title>Créateur d'histoires</title>
<link rel="stylesheet" href="css/general.css">
<script src="js/ajax.js"></script>
<script src="js/json.js"></script>
<script
	src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
</head>
<body>
	<div class="container-fluid">
		<a class="btn btn-info btn-lg btn-block" href="index.html">Retourner
			au menu principal</a>
		<h1 class="text-center">Créateur d'histoires</h1>
		<h2 class="text-center">Les histoires</h2>
		
		<div class="form-group" id="divStory">
				<select class="form-control" id="selectStory">
				</select>
		</div>
	</div>
	<script>
		displayStories(); 
		// displayTable("Story", "Les histoires");
		// 		displayTable("Character", "Les personnages");
		// 		displayTable("Item", "Les items");

		function displayStories() 
		{
			var select = document.getElementById("selectStory");
			
			var request = new XMLHttpRequest();
			request.open('GET', "stories");
			
			request.onload = function() {
				if(request.status === 200)
				{
					var pojos = JSON.parse(request.responseText);
					var select = document.getElementById("selectStory");
					for(i in pojos)
					{
						var option = document.createElement("option");
						option.value = pojos[i]["id"];
						option.innerHTML = pojos[i]["name"];
						select.appendChild(option);
					}
					var p = document.createElement("p");
					p.innerHTML = pojos[i]["synopsis"];
					document.getElementById("divStory").appendChild(p);
				}
				else
				{
					console.log("fail " + request.status);
				}
			};
			request.send();
			
		}

		function displayTable(table, title) {
			var container = document.createElement("div");
			container.className = "container-fluid text-center";
			container.id = "container" + table;

			var titleDiv = document.createElement("h2");
			titleDiv.innerHTML = title;
			container.appendChild(titleDiv);

			var addButton = document.createElement("a");
			addButton.className = "btn btn-primary btn-lg btn-block";
			addButton.innerHTML = "Ajouter";
			addButton.href = "form" + table + ".html?id=0";
			container.appendChild(addButton);

			document.body.appendChild(container);
			getPojos(table, displayList);
		}

		function displayList(table, pojos) {

			if (pojos.length > 0) {
				displayKeys(table, pojos);
				displayValues(table, pojos);
			}
		}

		function displayKeys(table, pojos) {
			var container = document.getElementById("container" + table);
			var row = document.createElement("div");
			row.className = "row";

			var keys = Object.keys(pojos[0]);
			for (key in keys) {
				var col = document.createElement("div");
				col.className = "col-sm-1 panel panel-default";
				col.innerHTML = keys[key];
				row.appendChild(col);
			}
			var col = document.createElement("div");
			col.className = "panel panel-default col-sm-" + (12 - keys.length);
			col.innerHTML = "Action";
			row.appendChild(col);
			container.appendChild(row);
		}

		function displayValues(table, pojos) {
			var container = document.getElementById("container" + table);
			var length = 0;

			for (var i = 0; i < pojos.length; i++) {
				var row = document.createElement("div");
				row.className = "row form-group";

				var pojo = pojos[i];
				var length = Object.keys(pojos[i]).length;

				for (value in pojos[i]) {
					var col = document.createElement("div");
					col.className = "col-sm-1";
					col.style.wordWrap = "break-word";
					col.innerHTML = pojos[i][value];
					row.appendChild(col);
				}
				var col = document.createElement("div");
				col.className = "col-sm-" + (12 - length);
				var updateButton = document.createElement("a");
				updateButton.className = "btn btn-warning btn-block btn-lg";
				updateButton.innerHTML = "Modifier";
				updateButton.href = "form" + table + ".html?id=" + pojo["id"];
				col.appendChild(updateButton);
				row.appendChild(col);
				container.appendChild(row);
			}
		}
	</script>
</body>
</html>