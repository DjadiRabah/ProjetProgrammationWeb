<!DOCTYPE html>
<html>
<head>
<meta name="viewport" charset="UTF-8">
<title>Page de combat</title>
<link rel="stylesheet" href="css/general.css">
<script src="js/ajax.js"></script>
<script src="cookies.js"></script>
<title>Insert title here</title>
</head>
<body>
</br></br></br>
<div class="container jumbotron" id="action" >
  <p class="text-center" id="contexte">Contexte</p>
</div>

<div class="container text-center" >
	
  <div class="row row-eq-height"  id="combat">
  <!--
   <div class="col-sm-4 "  id="balise_gentil">
      <img src="" alt="gentil" class="img-responsive" id="gentil">
      
       <div class="progress progress-striped active">
 		 <div class="progress-bar" style="width: 70%"> pdv/pdv</div>
		</div> 
		
    </div>
    <div class="col-sm-4">
      <img src="image/versus.jpg" alt="versus" class="img-responsive" id="versus" >
    	
    </div>
    <div class="col-sm-4">
    
     	<img src="image/orc.jpg" alt="gentil" class="img-responsive" id="mechant" >
      
       	<div class="progress progress-striped active" id="balise_mechant">
 		 <div class="progress-bar" style="width: 70%" > pdv/pdv</div>
		</div>
    </div> -->
  </div>
</div>
</div>

</br>
</br>
<!--<div class="container jumbotron" id="se_Passe">
  <p>This is a simple hero unit, a simple jumbotron-style component for calling extra attention to featured content or information.</p>
 
</div> -->


<div class="container jumbotron" id="action">
  <h2>Actions:</h2>
	<a id="action1"  display="none"></a>
  	<a id="action2"  display="none"></a>
	<a id="action3"  display="none"></a>
 
</div>




<script>
	
		
</script>

<script>
		//getPojoById("screen",23, setScreen);
		window.onload = function ()
		{
				getPojoById("screen",1, setScreen);
		}
		function setScreen (screen)
		{
			document.getElementById("combat").innerHTML="";
			document.getElementById("action2").style.display = "none";
			document.getElementById("action3").style.display = "none";
			if (document.getElementById('happened') != undefined)
			{
				document.body.removeChild(document.getElementById('happened'));
			}
			
			document.getElementById("contexte").innerHTML= screen["message"];
			
			if (screen["idCharacter"] == 0)
			{
				
				var div1 = document.createElement("div");
				div1.className = "col-sm-2";
				var div2 = document.createElement("div");
				div2.className = "col-sm-2";
				var character = document.createElement("div");
				character.className = "col-sm-8";
				var barre = document.createElement("div");
				barre.className = "progress progress-striped active";
				var pdv = document.createElement("div");
				pdv.className = "progress-bar";
				pdv.style = "width:"+parseFloat(findValueCookie("hp"))/parseFloat(findValueCookie("hpMax"))*100+"%";
				pdv.innerHTML = findValueCookie("hp")+"/"+findValueCookie("hpMax");
				var image = document.createElement("img");
				image.className = "img";
				image.src = "image/nain.jpg";
				image.alt = "gentil";
				character.appendChild(image);
				
				document.getElementById("combat").appendChild(div1);
				
				document.getElementById("combat").appendChild(character);
				document.getElementById("combat").appendChild(div2);
				barre.appendChild(pdv);
				character.appendChild(barre);
				
				
				if (screen["action1"] != "NULL")
				{
					document.getElementById("action1").style.display = "block";
					document.getElementById("action1").innerHTML=screen["action1"];
					document.getElementById("action1").onclick = setNextScreen.bind(this, [screen["idScreen1"]]) ;
	
				}
				if (screen["action2"] != "NULL")
				{
					document.getElementById("action2").style.display = "block";
					document.getElementById("action2").innerHTML=screen["action2"];
					document.getElementById("action2").onclick = setNextScreen.bind(this, [screen["idScreen2"]]) ;
				}
				if (screen["action3"] != "NULL")
				{
					document.getElementById("action3").style.display = "block";
					document.getElementById("action3").innerHTML=screen["action3"];
					document.getElementById("action3").onclick = setNextScreen.bind(this, [screen["idScreen3"]]) ;
				}
				
				
			}
			else
			{
				console.log("set screen");
				getPojoById("character",screen["idCharacter"], setEnemy);
				
				//gentil
				var character = document.createElement("div");
				character.className = "col-sm-4";
				var barre = document.createElement("div");
				barre.className = "progress progress-striped active";
				var pdv = document.createElement("div");
				pdv.className = "progress-bar";
				var width = parseFloat(findValueCookie("hp"))/parseFloat(findValueCookie("hpMax"))*100;
				//id gentil
				pdv.id= "pdv";
				
				pdv.style = "width:"+width+"%";
				pdv.innerHTML = findValueCookie("hp")+"/"+findValueCookie("hpMax");
				var image = document.createElement("img");
				image.className = "img-responsive";
				image.src = "image/nain.jpg";
				image.alt = "gentil";
				character.appendChild(image);
				
				document.getElementById("combat").appendChild(character);
				barre.appendChild(pdv);
				character.appendChild(barre);
				
				//versus
				var versus = document.createElement("div");
				versus.className = "col-sm-4";
								
				var image = document.createElement("img");
				image.className = "img-responsive";
				image.src = "image/versus.jpg";
				image.alt = "versus";
				versus.appendChild(image);
				document.getElementById("combat").appendChild(versus);
				
				//Ce qui se passe
			
				var happened = document.createElement("div");
				happened.className = "container jumbotron";
				happened.id = "happened";
				document.body.appendChild(happened);
				
				//Action
				document.getElementById("action1").style.display = "block";
				document.getElementById("action1").innerHTML= "taper";
				document.getElementById("action1").onclick = attack;
				
				//(hpKey,defenseKey,nameKey,dodgeKey,attackEKey)
				
				document.cookie = "screen1="+screen["idScreen1"];

			}
		}
</script>


</body>
<script>
	function setNextScreen(id)
	{
		document.getElementById("combat").innerHTML= "";
		getPojoById("screen",id, setScreen);
		
	}
	
	function setEnemy(character)
	{
		
		//mechant
				var mechant = document.createElement("div");
				mechant.className = "col-sm-4";
				var barremechant = document.createElement("div");
				barremechant.className = "progress progress-striped active";
				var pdvmechant = document.createElement("div");
				pdvmechant.className = "progress-bar";
				pdvmechant.style = "width: 100%";
				pdvmechant.id ="pdvmechant";
				pdvmechant.innerHTML = character["hp"]+"/"+character["hp"];
				
				
				
				var imagemechant = document.createElement("img");
				imagemechant.className = "img-responsive";
				imagemechant.src = "image/"+character["filename"];
				imagemechant.alt = "mechant";
				mechant.appendChild(imagemechant);
				
				document.getElementById("combat").appendChild(mechant);
				barremechant.appendChild(pdvmechant);
				mechant.appendChild(barremechant);
				
				//creer des cookie
				document.cookie = "hpE ="+character["hp"];
				document.cookie = "hpMaxE ="+character["hp"];
				document.cookie = "nameE ="+character["name"];
				document.cookie = "attackE ="+character["attack"];
				document.cookie = "dodgeE ="+character["dodge"];
				document.cookie = "defenseE ="+character["defense"];
				
				console.log(document.cookie);
				
		
	}
	function attack()
	{
		
		document.getElementById('happened').innerHTML= "";
		console.log(document.cookie);
		
		
		if((parseInt(findValueCookie("hp")) != 0 ) && (parseInt(findValueCookie("hpE")) != 0))
		{
			attackCharacter("defenseE","nameE","dodgeE","attack","pdvmechant","hpE");	
			attackCharacter("defense","name","dodge","attackE","pdv","hp");	
			
			if (parseInt(findValueCookie("hp")) == 0)
			{
				document.getElementById('happened').innerHTML+="Vous èté mort";
				document.getElementById("action1").innerHTML= "Retourner a l'acceuille";
				document.getElementById("action1").href = "chooseCharacter.html";
				
			}
			else if(parseInt(findValueCookie("hpE")) == 0)
			{
				
				document.getElementById('happened').innerHTML+="Vous avez terrassé "+findValueCookie("nameE");
				document.getElementById("action1").innerHTML="Avancer";
				document.getElementById("action1").onclick = setNextScreen.bind(this, [findValueCookie("screen1")]) ;
			}
		}
	}
	function attackCharacter (defenseKey,nameKey,dodgeKey,attackKey,pdv,hpKey)
	{
		var pdvattaque = document.getElementById(pdv);
		
		hp = parseInt(pdvattaque.innerHTML.split("/")[0]);
		hpmax = parseInt(pdvattaque.innerHTML.split("/")[1]);
		defense = parseInt(findValueCookie(defenseKey));
		name = findValueCookie(nameKey);
		dodge = parseFloat(findValueCookie(dodgeKey));
		attack = parseInt(findValueCookie(attackKey));
		console.log(dodge);
		
		if (Math.random() < dodge)
		{
			
			document.getElementById('happened').innerHTML+= name+" à esquivé </br> ";
			
		}
		else
		{
			
			document.getElementById('happened').innerHTML+= name +" à été touché </br>";
			 if (attack > hp + defense)
			{
				
				hp = 0;
			}
			else
			{
				hp = hp - attack + defense; 	
			}
			
			pdvattaque.style = "width:"+ hp/hpmax*100+"%"; 
			pdvattaque.innerHTML = hp+"/"+hpmax;
			document.cookie = hpKey+"="+hp; 
		}
	}
</script>
</html>


